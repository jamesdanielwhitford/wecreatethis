<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#333">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Search - Birdle</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <!-- Sticky Navbar -->
  <nav class="game-navbar search-navbar">
    <a href="index" class="back-btn">&larr; Back</a>
    <h1 style="font-size: 18px; margin: 0; position: absolute; left: 50%; transform: translateX(-50%);">Search</h1>
    <button id="scroll-to-top" class="scroll-to-top-nav" style="display: none;">‚Üë</button>
  </nav>

  <!-- Search Bar (Top Priority) -->
  <div class="search-bar">
    <input type="text" id="bird-search" placeholder="Search birds...">
  </div>

  <!-- Current Location Button -->
  <button id="current-location-btn" class="current-location-btn">
    <span id="current-location-text">Select Location</span>
  </button>

  <!-- Cache Button -->
  <div id="cache-prompt" style="display: none; margin: 8px 0; padding: 10px; background: #f5f7ff; border-radius: 6px; font-size: 13px;">
    <span id="cache-prompt-text">Save for offline?</span>
    <button id="cache-country-btn" style="margin-left: 8px; padding: 6px 12px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;">Cache Country</button>
  </div>

  <!-- Sort & Filter Controls -->
  <div class="filter-row">
    <select id="sort-type">
      <option value="most-likely">Sort: Most Likely</option>
      <option value="alphabetical">Sort: A-Z</option>
      <option value="recent">Recently Viewed</option>
    </select>
    <select id="seen-filter">
      <option value="all">Show All</option>
      <option value="hide">Hide Seen</option>
      <option value="only">Only Seen</option>
    </select>
  </div>

  <!-- Location Modal -->
  <div id="location-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>Update Search Location</h2>

      <!-- Option 1: Country/Region Dropdown -->
      <div class="location-option">
        <h3>Select Region</h3>
        <div class="filter-row region-filters">
          <select id="modal-country-filter">
            <option value="">Select country...</option>
          </select>
          <select id="modal-state-filter" disabled>
            <option value="">State/Province...</option>
          </select>
        </div>
        <button id="apply-region-btn" class="btn-primary" disabled>Apply Region</button>
      </div>

      <!-- Option 2: Use GPS Coordinates -->
      <div class="location-option">
        <h3>Use Current Location</h3>
        <p class="hint">Use your precise GPS coordinates for hyper-local results</p>
        <button id="use-gps-btn" class="btn-primary">üìç Use My Location</button>
        <p id="gps-status" class="hint" style="display:none; margin-top: 8px;"></p>
      </div>

      <!-- Option 3: Pick on Map -->
      <div class="location-option">
        <h3>Pick on Map</h3>
        <button id="modal-pick-map-btn" class="btn-primary">üìç Pick Location on Map</button>
      </div>

      <button id="location-modal-close" class="btn-secondary">Cancel</button>
    </div>
  </div>

  <!-- Map Picker -->
  <div id="map-container" style="display:none;">
    <div id="map"></div>
    <div class="map-actions">
      <button id="map-cancel-btn">Cancel</button>
      <button id="map-confirm-btn">Search here</button>
    </div>
  </div>

  <!-- Loading State -->
  <div id="loading" class="loading" style="display:none;">Loading birds...</div>

  <!-- Bird List -->
  <ul id="bird-list" class="bird-list"></ul>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="location.js"></script>
  <script src="db.js"></script>
  <script src="ebird.js"></script>
  <script src="app.js"></script>
</body>
</html>
