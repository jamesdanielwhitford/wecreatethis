<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#333">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Puzzle Help">
  <title>Puzzle Help - We Create This</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      color: #fff;
      margin-bottom: 30px;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px 16px;
      font-size: 18px;
      border: 2px solid #444;
      border-radius: 8px;
      background: #2a2a4e;
      color: #fff;
      outline: none;
      transition: border-color 0.2s;
    }
    input[type="text"]:focus {
      border-color: #6c63ff;
    }
    .output-box {
      background: #2a2a4e;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 16px;
      min-height: 60px;
      font-size: 18px;
      font-family: 'Courier New', monospace;
      word-break: break-all;
      user-select: all;
    }
    .output-box:empty::before {
      content: 'Output will appear here...';
      color: #666;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #6c63ff;
      text-decoration: none;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    .copy-btn {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 16px;
      background: #6c63ff;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .copy-btn:hover {
      background: #5a52d5;
    }
    .copy-btn.copied {
      background: #4caf50;
    }
  </style>
</head>
<body>
  <a href="/" class="back-link">&larr; Back to Home</a>
  <h1>Puzzle Help</h1>
  <div class="container">
    <div>
      <label for="input">Encode</label>
      <input type="text" id="input" placeholder="Enter text to encode..." autocomplete="off">
    </div>
    <div>
      <label>Encoded Output</label>
      <div class="output-box" id="output"></div>
    </div>
    <button class="copy-btn" id="copyBtn">Copy</button>
  </div>

  <div class="container" style="margin-top: 40px;">
    <div>
      <label for="decodeInput">Decode</label>
      <input type="text" id="decodeInput" placeholder="Enter text to decode..." autocomplete="off">
    </div>
    <div>
      <label>Decoded Output</label>
      <div class="output-box" id="decodeOutput"></div>
    </div>
    <button class="copy-btn" id="copyBtnDecode">Copy</button>
  </div>

  <script>
    function shiftChar(char, shift) {
      if (/[a-zA-Z]/.test(char)) {
        const base = char === char.toUpperCase() ? 'A'.charCodeAt(0) : 'a'.charCodeAt(0);
        // Handle negative shifts properly with double modulo
        return String.fromCharCode(((char.charCodeAt(0) - base + shift) % 26 + 26) % 26 + base);
      }
      return char;
    }

    function transformString(inputString) {
      if (!inputString) return '';

      const output = [];
      let iIdx = 0;
      let m1 = 1;
      let m2 = 1;

      // Step S: shift by +1, advance both
      if (iIdx < inputString.length) {
        output.push(shiftChar(inputString[iIdx], 1));
        iIdx++;
      }

      // Step A: shift by +1, advance both
      if (iIdx < inputString.length) {
        output.push(shiftChar(inputString[iIdx], 1));
        iIdx++;
      }

      // Step B: add dash, don't advance i
      if (iIdx < inputString.length) {
        output.push('-');
      }

      // Loop C and D until input exhausted
      while (iIdx < inputString.length) {
        // Step C: m1 = m1 + m2, o = i + m1, advance o only
        m1 = m1 + m2;
        output.push(shiftChar(inputString[iIdx], m1));

        // Step D: m2 = m1 + m2, o = i + m2, advance both
        if (iIdx < inputString.length) {
          m2 = m1 + m2;
          output.push(shiftChar(inputString[iIdx], m2));
          iIdx++;
        }
      }

      return output.join('');
    }

    function reverseTransformString(inputString) {
      if (!inputString) return '';

      const output = [];
      let iIdx = 0;
      let m1 = 1;
      let m2 = 1;

      // Step S: shift by -1 (reverse of +1)
      if (iIdx < inputString.length) {
        output.push(shiftChar(inputString[iIdx], -1));
        iIdx++;
      }

      // Step A: shift by -1 (reverse of +1)
      if (iIdx < inputString.length) {
        output.push(shiftChar(inputString[iIdx], -1));
        iIdx++;
      }

      // Step B: skip the dash
      if (iIdx < inputString.length && inputString[iIdx] === '-') {
        iIdx++;
      }

      // Loop C and D - each original char produced 2 encoded chars
      while (iIdx < inputString.length) {
        // Step C: m1 = m1 + m2, this char was shifted by m1
        const oldM2 = m2;
        m1 = m1 + m2;
        output.push(shiftChar(inputString[iIdx], -m1));
        iIdx++;

        // Step D: m2 = m1 + old_m2, skip this char (it's the duplicate)
        m2 = m1 + oldM2;
        if (iIdx < inputString.length) {
          iIdx++;
        }
      }

      return output.join('');
    }

    const inputEl = document.getElementById('input');
    const outputEl = document.getElementById('output');

    inputEl.addEventListener('input', () => {
      outputEl.textContent = transformString(inputEl.value);
    });

    const decodeInputEl = document.getElementById('decodeInput');
    const decodeOutputEl = document.getElementById('decodeOutput');

    decodeInputEl.addEventListener('input', () => {
      decodeOutputEl.textContent = reverseTransformString(decodeInputEl.value);
    });

    const copyBtn = document.getElementById('copyBtn');
    copyBtn.addEventListener('click', () => {
      const text = outputEl.textContent;
      if (!text) return;
      navigator.clipboard.writeText(text).then(() => {
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
          copyBtn.classList.remove('copied');
        }, 1500);
      });
    });

    const copyBtnDecode = document.getElementById('copyBtnDecode');
    copyBtnDecode.addEventListener('click', () => {
      const text = decodeOutputEl.textContent;
      if (!text) return;
      navigator.clipboard.writeText(text).then(() => {
        copyBtnDecode.textContent = 'Copied!';
        copyBtnDecode.classList.add('copied');
        setTimeout(() => {
          copyBtnDecode.textContent = 'Copy';
          copyBtnDecode.classList.remove('copied');
        }, 1500);
      });
    });
  </script>
</body>
</html>
